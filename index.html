<!DOCTYPE html>
<html lang="en" class="dark">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Lampy Control</title>

        <script src="https://cdn.tailwindcss.com"></script>
        <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
        <script
            src="https://kit.fontawesome.com/e0c6d65845.js"
            crossorigin="anonymous"
        ></script>
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Jura:wght@400;500;600;700;800&display=swap"
            rel="stylesheet"
        />

        <script>
            tailwind.config = {
                darkMode: "class",
                theme: {
                    extend: {
                        fontFamily: {
                            jura: ["Jura", "sans-serif"],
                        },
                        colors: {
                            lampy: {
                                cream: "#ece0cf",
                                dark: "#1a1a1a",
                                copper: "#b45309",
                                accent: "#ff4500",
                            },
                        },
                        animation: {
                            "spin-slow": "spin 8s linear infinite",
                            spiral: "spiral 20s linear infinite",
                            "pulse-led": "pulseLed 2s ease-in-out infinite",
                            "slide-up":
                                "slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1)",
                            "fade-in": "fadeIn 0.5s ease-out",
                            "midi-glow":
                                "midiGlow 1.5s ease-in-out infinite alternate",
                        },
                        keyframes: {
                            spiral: {
                                "0%": { transform: "rotateY(0deg)" },
                                "100%": { transform: "rotateY(360deg)" },
                            },
                            pulseLed: {
                                "0%, 100%": { opacity: "0.8" },
                                "50%": { opacity: "1" },
                            },
                            slideUp: {
                                "0%": { transform: "translateY(100%)" },
                                "100%": { transform: "translateY(0)" },
                            },
                            fadeIn: {
                                "0%": { opacity: "0" },
                                "100%": { opacity: "1" },
                            },
                            midiGlow: {
                                "0%": { boxShadow: "0 0 10px currentColor" },
                                "100%": {
                                    boxShadow:
                                        "0 0 20px currentColor, 0 0 30px currentColor",
                                },
                            },
                        },
                    },
                },
            };
        </script>

        <link rel="stylesheet" href="styles.css" />
    </head>

    <body class="min-h-screen font-jura overflow-hidden" id="app">
        <!-- Floating Controls -->
        <div class="fixed top-4 left-4 z-50">
            <button
                @click="showSettings = true"
                class="floating-btn settings-btn group"
            >
                <svg
                    viewBox="0 0 200 200"
                    xmlns="http://www.w3.org/2000/svg"
                    class="w-8 h-8 animate-spin-slow"
                >
                    <defs>
                        <radialGradient
                            id="nucleusGradient"
                            cx="50%"
                            cy="50%"
                            r="50%"
                        >
                            <stop offset="0%" stop-color="#FFB347" />
                            <stop offset="100%" stop-color="#FF6B35" />
                        </radialGradient>
                    </defs>
                    <g transform="translate(100,100)">
                        <ellipse
                            cx="0"
                            cy="0"
                            rx="50"
                            ry="15"
                            fill="none"
                            :stroke="isDark ? '#40E0D0' : '#0891b2'"
                            stroke-width="3"
                            opacity="0.9"
                        />
                        <ellipse
                            cx="0"
                            cy="0"
                            rx="50"
                            ry="15"
                            fill="none"
                            :stroke="isDark ? '#40E0D0' : '#0891b2'"
                            stroke-width="3"
                            opacity="0.9"
                            transform="rotate(60)"
                        />
                        <ellipse
                            cx="0"
                            cy="0"
                            rx="50"
                            ry="15"
                            fill="none"
                            :stroke="isDark ? '#40E0D0' : '#0891b2'"
                            stroke-width="3"
                            opacity="0.9"
                            transform="rotate(120)"
                        />
                    </g>
                    <circle
                        cx="100"
                        cy="100"
                        r="15"
                        fill="url(#nucleusGradient)"
                    />
                </svg>
            </button>
        </div>

        <div class="fixed top-4 right-4 z-50">
            <button @click="toggleTheme" class="floating-btn theme-btn">
                <i
                    :class="isDark ? 'fas fa-sun' : 'fas fa-moon'"
                    class="text-lg"
                ></i>
            </button>
        </div>

        <!-- Desktop Layout - Flipped -->
        <div class="hidden lg:flex h-screen">
            <!-- Left Side - Pattern Controls -->
            <div class="w-1/3 h-full controls-panel">
                <div class="h-full overflow-y-auto p-6 space-y-6">
                    <!-- Pattern Selection -->
                    <section class="control-section">
                        <h3 class="section-title">Patterns</h3>
                        <div class="pattern-grid-midi">
                            <button
                                v-for="pattern in patterns"
                                :key="pattern.id"
                                @click="selectPattern(pattern)"
                                :class="{ 'active': currentPattern?.id === pattern.id }"
                                class="pattern-pad"
                            >
                                <div class="pattern-icon">
                                    <i
                                        :class="pattern.icon"
                                        class="text-2xl"
                                    ></i>
                                </div>
                                <div
                                    class="pattern-indicator"
                                    :style="{ backgroundColor: pattern.colors[0] }"
                                ></div>
                            </button>
                        </div>
                    </section>

                    <!-- Color Rack -->
                    <section v-if="currentPattern" class="control-section">
                        <h3 class="section-title">Color Rack</h3>
                        <div class="color-rack">
                            <div
                                v-for="(color, index) in currentPattern.colors"
                                :key="index"
                                class="color-channel"
                            >
                                <div class="color-slot">
                                    <select
                                        v-model="currentPattern.colors[index]"
                                        @change="onColorChange"
                                        class="color-select"
                                    >
                                        <option
                                            v-for="colorOption in neopixelColors"
                                            :key="colorOption.value"
                                            :value="colorOption.value"
                                            :style="{ backgroundColor: colorOption.value }"
                                        >
                                            {{ colorOption.name }}
                                        </option>
                                    </select>
                                    <div
                                        class="color-led"
                                        :style="{ backgroundColor: color }"
                                    ></div>
                                </div>
                                <div class="color-label">{{ index + 1 }}</div>
                            </div>
                            <button @click="resetColors" class="reset-channel">
                                <i class="fas fa-undo"></i>
                            </button>
                        </div>
                    </section>
                </div>
            </div>

            <!-- Right Side - Lampy Simulator -->
            <div class="w-2/3 h-full flex flex-col simulator-panel">
                <!-- Simulator -->
                <div class="flex-1 flex items-center justify-center">
                    <div class="lampy-container-large">
                        <!-- Copper Tube -->
                        <div class="copper-tube-large opacity-40"></div>
                        <div class="lampy-spiral animate-spiral">
                            <!-- LED Spiral -->
                            <div
                                v-for="i in 72"
                                :key="i"
                                class="led-large"
                                :style="getLEDPosition(i)"
                            >
                                <div
                                    class="led-light-large"
                                    :style="getLEDColor(i)"
                                    :class="{ 'animate-pulse-led': getLEDIntensity(i) > 0.7 }"
                                ></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Simulator Controls -->
                <div class="simulator-controls">
                    <div class="control-row">
                        <!-- Brightness Fader -->
                        <div class="sim-fader">
                            <label class="sim-label">Brightness</label>
                            <input
                                v-model="brightness"
                                type="range"
                                min="1"
                                max="100"
                                class="sim-slider"
                            />
                            <div class="sim-value">{{ brightness }}%</div>
                        </div>

                        <!-- Speed Fader -->
                        <div class="sim-fader">
                            <label class="sim-label">Speed</label>
                            <input
                                v-model="speed"
                                type="range"
                                min="1"
                                max="10"
                                class="sim-slider"
                            />
                            <div class="sim-value">
                                {{ getSpeedLabel(speed) }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mobile Layout -->
        <div class="lg:hidden h-screen flex flex-col">
            <!-- Simulator (Full Screen) -->
            <div class="flex-1 simulator-panel-mobile">
                <div class="lampy-container-mobile">
                    <!-- Copper Tube -->
                    <div class="copper-tube-mobile"></div>
                    <div class="lampy-spiral animate-spiral">
                        <!-- LED Spiral -->
                        <div
                            v-for="i in 72"
                            :key="i"
                            class="led-mobile"
                            :style="getLEDPositionMobile(i)"
                        >
                            <div
                                class="led-light-mobile"
                                :style="getLEDColor(i)"
                                :class="{ 'animate-pulse-led': getLEDIntensity(i) > 0.7 }"
                            ></div>
                        </div>
                    </div>
                </div>

                <!-- Mobile Simulator Controls -->
                <div class="mobile-sim-controls">
                    <div class="mobile-control-row">
                        <!-- Mini Faders -->
                        <div class="mobile-fader">
                            <input
                                v-model="brightness"
                                type="range"
                                min="1"
                                max="100"
                                class="mobile-slider"
                            />
                            <label class="mobile-label">BRI</label>
                        </div>

                        <div class="mobile-fader">
                            <input
                                v-model="speed"
                                type="range"
                                min="1"
                                max="10"
                                class="mobile-slider"
                            />
                            <label class="mobile-label">SPD</label>
                        </div>

                        <!-- Live Indicator -->
                        <div class="mobile-live">
                            <div class="mobile-live-dot"></div>
                            <span class="mobile-live-text">LIVE</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Mobile Pattern Chicklet Strip -->
            <div class="mobile-pattern-strip">
                <div class="pattern-chicklets">
                    <button
                        v-for="pattern in patterns"
                        :key="pattern.id"
                        @click="selectPattern(pattern)"
                        :class="{ 'active': currentPattern?.id === pattern.id }"
                        class="pattern-chicklet"
                    >
                        <i :class="pattern.icon" class="text-lg"></i>
                        <div
                            class="chicklet-dot"
                            :style="{ backgroundColor: pattern.colors[0] }"
                        ></div>
                    </button>
                </div>

                <!-- Color Strip -->
                <div v-if="currentPattern" class="color-strip">
                    <div
                        v-for="(color, index) in currentPattern.colors"
                        :key="index"
                        class="color-chicklet"
                    >
                        <select
                            v-model="currentPattern.colors[index]"
                            @change="onColorChange"
                            class="color-select-mobile"
                        >
                            <option
                                v-for="colorOption in neopixelColors"
                                :key="colorOption.value"
                                :value="colorOption.value"
                            >
                                {{ colorOption.name }}
                            </option>
                        </select>
                        <div
                            class="color-preview"
                            :style="{ backgroundColor: color }"
                        ></div>
                    </div>
                    <button @click="resetColors" class="reset-chicklet">
                        <i class="fas fa-undo"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Settings Modal -->
        <div
            v-if="showSettings"
            class="settings-modal"
            @click="showSettings = false"
        >
            <div class="settings-content" @click.stop>
                <div class="settings-header">
                    <h2 class="text-xl font-bold">Lampy Settings</h2>
                    <button @click="showSettings = false" class="modal-close">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="settings-body">
                    <!-- Device Selection -->
                    <div class="settings-section">
                        <h3 class="settings-subtitle">Device</h3>
                        <div class="device-selector">
                            <select
                                v-model="selectedDevice"
                                class="device-dropdown"
                            >
                                <option
                                    v-for="device in discoveredDevices"
                                    :key="device.id"
                                    :value="device"
                                >
                                    {{ device.name }} ({{ device.type }})
                                </option>
                            </select>
                            <button @click="scanForDevices" class="scan-btn">
                                <i class="fas fa-search"></i>
                                Scan
                            </button>
                        </div>
                    </div>

                    <!-- Connection Settings -->
                    <div class="settings-section">
                        <h3 class="settings-subtitle">Connection</h3>
                        <div class="connection-grid">
                            <div class="connection-item">
                                <div class="connection-icon wifi">
                                    <i class="fas fa-wifi"></i>
                                </div>
                                <div class="connection-info">
                                    <span class="connection-label">WiFi</span>
                                    <span class="connection-status"
                                        >{{ wifiStatus }}</span
                                    >
                                </div>
                                <button
                                    @click="configureWifi"
                                    class="config-btn"
                                >
                                    <i class="fas fa-cog"></i>
                                </button>
                            </div>

                            <div class="connection-item">
                                <div class="connection-icon bluetooth">
                                    <i class="fab fa-bluetooth"></i>
                                </div>
                                <div class="connection-info">
                                    <span class="connection-label"
                                        >Bluetooth</span
                                    >
                                    <span class="connection-status"
                                        >{{ bluetoothStatus }}</span
                                    >
                                </div>
                                <button
                                    @click="configureBluetooth"
                                    class="config-btn"
                                >
                                    <i class="fas fa-cog"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Device Info -->
                    <div class="settings-section">
                        <h3 class="settings-subtitle">Device Info</h3>
                        <div class="info-grid">
                            <div class="info-item">
                                <span class="info-label">Firmware</span>
                                <span class="info-value"
                                    >{{ deviceInfo.firmware }}</span
                                >
                            </div>
                            <div class="info-item">
                                <span class="info-label">Hardware</span>
                                <span class="info-value"
                                    >{{ deviceInfo.hardware }}</span
                                >
                            </div>
                            <div class="info-item">
                                <span class="info-label">LEDs</span>
                                <span class="info-value"
                                    >{{ deviceInfo.ledCount }}</span
                                >
                            </div>
                            <div class="info-item">
                                <span class="info-label">Uptime</span>
                                <span class="info-value"
                                    >{{ deviceInfo.uptime }}</span
                                >
                            </div>
                        </div>
                    </div>

                    <!-- Actions -->
                    <div class="settings-section">
                        <div class="settings-actions">
                            <button class="action-btn secondary">
                                <i class="fas fa-download"></i>
                                Firmware Update
                            </button>
                            <button class="action-btn secondary">
                                <i class="fas fa-code"></i>
                                Schematics
                            </button>
                            <button class="action-btn secondary">
                                <i class="fas fa-users"></i>
                                Community
                            </button>
                            <button class="action-btn primary">
                                <i class="fas fa-shopping-cart"></i>
                                Buy More Lampys
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script src="script.js"></script>
    </body>
</html>
